<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location Finder</title>
    <style>
        /* Loader (spinner) styles */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: none; /* Initially hidden */
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <script>
        function getLocation() {
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        let latitude = position.coords.latitude;
                        let longitude = position.coords.longitude;
                        document.getElementById("status").innerText = "Location obtained! Sending...";
                        document.getElementById("loader").style.display = "inline-block"; // Show loader
                        sendLocation(latitude, longitude);
                    },
                    function(error) {
                        document.getElementById("status").innerText = "Error getting location: " + error.message;
                    }
                );
            } else {
                document.getElementById("status").innerText = "Geolocation not supported by this browser.";
            }
        }

        function sendLocation(lat, lng) {
            let url = "https://script.google.com/macros/s/AKfycbwcFfPAA7pJJLy-pencEU30TqMY0Nz2DNVad6olZlfYga6qJCTPcKLR11CrUy7zwqoo/exec";
        
            let requestData = { latitude: lat, longitude: lng };
            
            fetch(url, {
                redirect: "follow",
                method: "POST",
                body: JSON.stringify(requestData),
                headers: {
                    "Content-Type": "text/plain;charset=utf-8",
                },
            })
            .then(response => response.json())
            .then(data => displayResults(data))
            .catch(error => console.error("Fetch Error:", error));
        }

        function displayResults(data) {
            let resultDiv = document.getElementById("results");
            resultDiv.innerHTML = ""; // Clear previous results
            document.getElementById("loader").style.display = "hidden";
            
            if (data.error) {
                resultDiv.innerHTML = `<p>Error: ${data.error}</p>`;
                return;
            }

            if (data.length === 0) {
                resultDiv.innerHTML = "<p>No locations found.</p>";
                return;
            }

            // Create table
            let table = document.createElement("table");
            table.border = "1";
            table.style.borderCollapse = "collapse";
            table.style.width = "100%";
            table.style.marginTop = "10px";

            // Create table header
            let thead = document.createElement("thead");
            let headerRow = document.createElement("tr");
            let headers = ["Name", "Address", "Distance", "Travel Time"];
            
            headers.forEach(text => {
                let th = document.createElement("th");
                th.textContent = text;
                th.style.border = "1px solid black";
                th.style.padding = "8px";
                th.style.textAlign = "left";
                headerRow.appendChild(th);
            });

            thead.appendChild(headerRow);
            table.appendChild(thead);

            // Create table body
            let tbody = document.createElement("tbody");
            data.forEach(entry => {
                let row = document.createElement("tr");

                let nameCell = document.createElement("td");
                nameCell.textContent = entry.name;
                nameCell.style.border = "1px solid black";
                nameCell.style.padding = "8px";

                let addressCell = document.createElement("td");
                addressCell.textContent = entry.address;
                addressCell.style.border = "1px solid black";
                addressCell.style.padding = "8px";

                let distanceCell = document.createElement("td");
                distanceCell.textContent = entry.distance;
                distanceCell.style.border = "1px solid black";
                distanceCell.style.padding = "8px";

                let travelTimeCell = document.createElement("td");
                travelTimeCell.textContent = entry.travel_time;
                travelTimeCell.style.border = "1px solid black";
                travelTimeCell.style.padding = "8px";

                row.appendChild(nameCell);
                row.appendChild(addressCell);
                row.appendChild(distanceCell);
                row.appendChild(travelTimeCell);

                tbody.appendChild(row);
            });

            table.appendChild(tbody);

            // Append table to results div
            resultDiv.appendChild(table);
            document.getElementById("status").innerText = "Results received!";
        }
    </script>
</head>
<body>
    <h2>Find Nearby Locations</h2>
    <button onclick="getLocation()">Get My Location</button>
    <p id="status">Click the button to find locations.</p>
    <span id="loader" class="loader"></span>
    <div id="results"></div>
</body>
</html>

